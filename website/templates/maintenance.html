{% extends "base.html" %}
{% import 'modal-form.html' as modal %}
{% import 'maintenance-forms.html' as maintenance_forms %}

{% block title %}Maintenance{% endblock %}

{% block content %}
<div class="col-lg-6 mx-auto">
    <h1 style="text-align: center;">Locations</h1>

    <table id="locations"
        class="table table-hover table-location sortable-table">
        <thead>
            <tr>
                <th scope="col"
                    class="col-3">Name</th>
                <th scope="col"
                    class="col-1 btn-icon-column">
                    <div class="btn-icon-container">
                        <button id="btn-add-location"
                            class="hoverable bi hover-bi-plus-square btn-icon"></button>
                    </div>
                </th>
            </tr>
        </thead>

        <tbody class="table-group-divider">
            {% for location in locations %}
            <tr data-location-id="{{ location.id }}">
                <td>{{ location.name }}</td>
                <td class="btn-icon-column">
                    <div class="btn-icon-container">
                        <button class="hoverable bi hover-bi-pencil btn-icon modal-trigger-edit-location"
                            data-location-id="{{ location.id }}"
                            data-location-name="{{ location.name }}"></button>
                        <button class="hoverable bi hover-bi-trash btn-icon modal-trigger-delete-location"
                            data-location-id="{{ location.id }}"
                            data-location-name="{{ location.name }}"></button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% call modal.new("add-location", "Add location", "/maintenance/add-location", "Add") %}
{{ maintenance_forms.add_edit_location('add') }}
{% endcall %}

{% call modal.new("delete-location", "Delete location: ", "/maintenance/delete-location", "Yes") %}
<input type="hidden"
    name="location_id"
    id="delete-location-id"
    value="">
<p>Are you sure you want to delete this location?</p>
{% endcall %}

{% call modal.new("edit-location", "Edit location", "/maintenance/edit-location", "Save") %}
{{ maintenance_forms.add_edit_location('edit') }}
{% endcall %}


{% for location in locations %}
<br />
<h2>{{ location.name }}</h2>

<table id="{{ location.name }}-venues"
    class="table table-hover">
    <thead>
        <tr>
            <th scope="col"
                class="col-3">Name</th>
            <th scope="col"
                class="col-3">Frequency</th>
            <th cope="col"
                class="col-2">Genre</th>
            <th scope="col"
                class="col-1 btn-icon-column">
                <div class="btn-icon-container">
                    <button class="hoverable bi hover-bi-plus-square btn-icon modal-trigger-add-venue"
                        data-location-id="{{ location.id }}"></button>
                </div>
            </th>
        </tr>
    </thead>

    <tbody class="table-group-divider">
        {% for venue in venues if venue.location_id == location.id %}
        <tr>
            <td>
                {% if venue.link %}
                <a href="{{ venue.link }}"
                    target="_blank">{{ venue.name }}</a>
                {% else %}
                {{ venue.name }}
                {% endif %}
            </td>
            <td>{{ venue.frequency}}</td>
            <td>{{ venue.genre }}</td>
            <td class="btn-icon-column">
                <div class="btn-icon-container">
                    <button class="hoverable bi hover-bi-pencil btn-icon modal-trigger-edit-venue"
                        data-venue-id="{{ venue.id }}"
                        data-venue-name="{{ venue.name }}"
                        data-venue-link="{{ venue.link }}"
                        data-venue-location-id="{{ location.id }}"
                        data-venue-frequency="{{ venue.frequency }}"
                        data-venue-genre="{{ venue.genre }}">
                    </button>
                    <button class="hoverable bi hover-bi-trash btn-icon modal-trigger-delete-venue"
                        data-venue-id="{{ venue.id }}"
                        data-venue-name="{{ venue.name }}">
                    </button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endfor %}

{% call modal.new("add-venue", "Add venue", "/maintenance/add-venue", "Add") %}
{{ maintenance_forms.add_edit_venue('add', locations)}}
{% endcall %}

{% call modal.new("delete-venue", "Delete venue: ", "/maintenance/delete-venue", "Yes") %}
<input type="hidden"
    name="venue_id"
    id="delete-venue-id">
<p>Are you sure you want to delete this venue?</p>
{% endcall %}

{% call modal.new("edit-venue", "Edit venue: ", "/maintenance/edit-venue", "Save") %}
{{ maintenance_forms.add_edit_venue('edit', locations)}}
{% endcall %}

<br />
<br />
<br />

{% endblock %}


{% block scripts %}
<script src="/static/maintenance.js"></script>
<script>
    document.documentElement.scrollTop = {{ session.get('scroll_position', 0) }};
</script>
{% endblock %}